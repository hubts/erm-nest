# Domain

본 문서에서는 프로젝트에서 구현된 도메인 `Auth`, `Event` 들의 기능에 대하여 설명합니다.

## Schema (Entity)

총 6개의 Schema(Table)이 구현되어 있습니다.

### `User`

유저 데이터를 가집니다.

-   Email/Password 기반 로그인/로그아웃
-   Role 기반 유저 역할 관리

| Role     | Description        |
| -------- | ------------------ |
| USER     | 일반 유저          |
| OPERATOR | 운영자             |
| AUDITOR  | 감사자 (로그 확인) |
| ADMIN    | 관리자             |

### `Token`

유저 갱신 토큰 데이터를 가집니다.

-   액세스 토큰 갱신을 위해 갱신 토큰을 저장
-   만료시간을 정의
-   `refresh` 기능을 통해 갱신 가능

### `Event`

이벤트, 달성 조건, 보상에 대한 데이터를 가집니다.

-   이벤트 이름, 설명, 상태, 기간 등의 정보
-   이벤트 보상 지급 방식(자동/수동)
-   이벤트 달성을 위한 조건
-   조건 충족 시 지급되는 보상

### `EventCondition`

이벤트 조건 기준에 대한 데이터를 가집니다.

-   유저의 이벤트를 참여하는 행동과 같은 로그 누적 시 키 값으로 활용하는 필드
-   이벤트 보상 요청 시 조건이 되는 값의 타입

### `EventRewardRequest`

이벤트 보상 요청에 대한 데이터를 가집니다.

-   이벤트 보상을 요청하는 유저 정보
-   요청하고자 하는 대상 이벤트
-   조건 충족 여부 및 보상 지급 방식에 따른 상태값
-   지급 완료 시 지급된 보상 정보

### `EventUserLogging`

유저의 이벤트 참여 행동을 로그로 누적하여, 보상 요청 시 자동 검사가 가능하도록 하는 데이터를 가집니다. (특히, 이 로그 데이터는 외부에서 실행된 다양한 기능들로 인해 데이터가 저장됩니다. 예를 들어, 로그인, 친구 초대 등의 기능에서 로그가 도출됩니다.)

-   유저의 정보
-   정의된 이벤트 조건 기준(키 값)
-   실제 발생한 값

## User Scenario

> `ADMIN` 은 모든 유저의 권한을 가지고 있어, 모든 기능들을 수행할 수 있습니다.

### 회원가입/로그인

1. `USER` 는 이메일과 비밀번호를 기반으로 회원가입합니다.
2. `USER` 는 로그인합니다.

### 이벤트 생성

1. `OPERATOR` 는 이메일과 비밀번호를 기반으로 회원가입합니다.
2. `OPERATOR` 는 로그인합니다.
3. `OPERATOR` 는 이벤트 조건 기준(e.g. 친구 초대, 연속 로그인 등)을 먼저 생성합니다.
4. `OPERATOR` 는 이벤트 조건과 그 달성 값, 그리고 보상 및 이벤트 정보들을 기반으로 이벤트를 생성합니다.

### 이벤트 수정

1. `OPERATOR` 는 요청된 보상이 없는 이벤트를 수정할 수 있습니다.
2. `OPERATOR` 는 이벤트의 정보들과 보상 정보를 수정할 수 있습니다.

### 이벤트 관련 로그 누적

1. `USER` 는 이벤트를 조회하여 확인합니다.
2. `USER` 는 시스템 내에서 로그인하거나, 친구를 초대하는 등 이벤트 조건 기준과 관련된 행동들을 수행합니다.
3. `USER` 가 수행한 행동들이 이벤트 참여 로그로 누적됩니다.

### 이벤트 보상 요청

1. `USER` 는 자신이 이벤트 보상을 요청할 수 있다고 생각하고, 해당 이벤트에 대한 보상을 요청합니다.
    - 1.1. 시스템은 자동으로 해당 유저가 이벤트 조건 기준을 달성했는지 확인합니다.
    - 1.2. 만약 달성하지 못했다면, 조건 불충분 상태가 됩니다.
    - 1.3. 만약 달성했다면,
        - 1.3.1. 자동 지급 방식이라면, 자동으로 보상이 지급되고 승인 상태가 됩니다.
        - 1.3.2. 수동 지급 방식이라면, 대기 상태가 됩니다.
2. `OPERATOR` 는 수동 지급 방식인 이벤트의 요청에 대하여 승인 또는 거절할 수 있습니다.
    - 2.1. 만약 승인한다면, 보상이 지급되고 승인 상태가 됩니다.
    - 2.2. 만약 거절한다면, 거절 상태가 됩니다.

### 이벤트 보상 요청 이력

1. `USER` 는 자신의 이벤트 보상 요청 이력을 확인할 수 있습니다.
2. `OPERATOR`, `AUDITOR` 는 모든 유저들의 이벤트 보상 요청 이력을 확인할 수 있습니다.
